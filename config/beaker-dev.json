{
  "id": "/beaker-dev",
  "apps": [
    {
      "id": "/beaker-dev/publications",
      "cmd": "",
      "cpus": 0.1,
      "mem": 100,
      "ports": [
        3003
      ],
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-publications",
          "portMappings": [
            {
              "containerPort": 3003,
              "servicePort": 3003,
              "protocol": "tcp"
            }
          ]
        }
      },
      "env": {
        "PUBLICATIONS_PORT": 3003,
        "PUBLICATIONS_DATABASE_URI": "datomic:mem://publications",
        "PUBLICATIONS_SEED_FILE": "seed.edn",
        "BAMBOO_HOST": "beaker-dev",
        "BAMBOO_PATH": "/publications/"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/publications/v1/status",
          "gracePeriodSeconds": 60,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 5
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      }
    },
    {
      "id": "/beaker-dev/web",
      "args":["run"],
      "cpus": 0.1,
      "mem": 100,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-web",
          "portMappings": [
            {
              "containerPort": 8081,
              "hostPort": 0,
              "servicePort": 8081,
              "protocol": "tcp"
            }
          ]
        }
      },
      "env": {
        "WEB_ROOT": "public",
        "BAMBOO_HOST": "beaker-dev",
        "BAMBOO_ACLS": "!{ path_beg -i /publications/ }"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      }
    }
  ]
}
