{
  "id": "/bunsen-staging",
  "apps": [
    {
      "id": "/bunsen-staging/web",
      "cmd": "",
      "cpus": 1,
      "mem": 1024,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-web",
          "portMappings": [
            {
              "containerPort": 8081
            }
          ]
        }
      },
      "env": {
        "BAMBOO_HOST": "bunsen-staging.withmojo.com",
        "BAMBOO_ACLS": "!{ path_beg -i /user } !{ path_beg -i /notebook } !{ path_beg -i /provisioner } !{ path_beg -i /marketplace } !{ path_beg -i /beaker } !{ path_beg -i /events }"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/beaker-staging/web",
      "cmd": "",
      "cpus": 1,
      "mem": 1024,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-web",
          "portMappings": [
            {
              "containerPort": 8081
            }
          ]
        }
      },
      "env": {
        "BAMBOO_HOST": "beaker-staging.withmojo.com",
        "BAMBOO_ACLS": "!{ path_beg -i /user } !{ path_beg -i /notebook } !{ path_beg -i /provisioner } !{ path_beg -i /marketplace } !{ path_beg -i /beaker } !{ path_beg -i /events }"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/bunsen-staging/api",
      "cmd": "",
      "cpus": 2,
      "mem": 2048,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-api",
          "portMappings": [
            {
              "containerPort": 3000
            }
          ]
        },
        "volumes" : [
          {
            "hostPath": "/mnt/gluster0/bunsen-staging/scratch",
            "containerPath": "/mnt/gluster0/bunsen-staging/scratch",
            "mode": "RW"
          }
        ]
      },
      "env": {
        "JAVA_OPTS": "-Xmx1792M",
        "JETTY_HTTP_PORT": 3000,
        "COOKIE_SALT": "r8T`628DaW90*?30)3qRx,2f8h?8(wG13:64K3=w00-8W7g962gM268D0lTS(Uq;^v15mY3gCj-u59k994_/@}W<",
        "DATOMIC_URI": "datomic:ddb://us-east-1/bunsen-staging/api",
        "DATOMIC_MIGRATIONS": "user/migrations.edn:notebook/migrations.edn:marketplace/migrations.edn:provisioner/migrations.edn",
        "ELASTICSEARCH_URI": "http://bunsen:s6nFTwtbZP3wHh@172.17.42.1:9200",
        "CONTAINER_COMPONENT": "marathon",
        "CONTAINER_GROUP": "bunsen-staging/beaker",
        "CONTAINER_DEFAULTS": "provisioner/container.edn",
        "STORE_COMPONENT": "filesystem",
        "STORE_ROOT": "/mnt/gluster0/bunsen-staging/scratch",
        "STORE_QUOTA": 10485760,
        "BAMBOO_ACLS": "{ path_beg -i /user } || { path_beg -i /notebook } || { path_beg -i /provisioner } || { path_beg -i /marketplace }",
        "MARATHON_URI": "http://cluster-master.withmojo.com:8080"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/user/v1/status",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "uris": [
        "file:///etc/.dockercfg"
      ],
      "dependencies": [
        "/bunsen-staging/datomic"
      ]
    },
    {
      "id": "/bunsen-staging/riemann",
      "cmd": "",
      "cpus": 1,
      "mem": 1024,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-riemann",
          "portMappings": [
            {
              "containerPort": 5556
            }
          ]
        }
      },
      "env": {
        "LIBRATO_USER": "chris@mojotech.com",
        "LIBRATO_TOKEN": "f7dbfefb544dbe35dc0812590ff6eaeb0d8eda87c53e707b3d60a68f7f0f451b",
        "BAMBOO_HOST": "bunsen-staging.withmojo.com",
        "BAMBOO_PATH": "/events"
      },
      "healthChecks": [
        {
          "protocol": "TCP",
          "path": ".",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0.5
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/bunsen-staging/datomic",
      "cmd": "",
      "cpus": 2,
      "mem": 2048,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "quay.io/mojotech/bunsen-datomic",
          "portMappings": [
            {
              "containerPort": 4334,
              "servicePort": 4334
            }
          ]
        }
      },
      "ports": [
        4334
      ],
      "env": {
        "DATOMIC_HOST": "0.0.0.0",
        "DATOMIC_ALT_HOST": "172.17.42.1",
        "DATOMIC_PORT": 4334,
        "DATOMIC_PROTOCOL": "ddb",
        "DATOMIC_AWS_DYNAMODB_TABLE": "bunsen-staging",
        "DATOMIC_AWS_DYNAMODB_REGION": "us-east-1",
        "DATOMIC_AWS_TRANSACTOR_ROLE": "cluster_slave_servers",
        "DATOMIC_AWS_PEER_ROLE": "cluster_slave_servers"
      },
      "healthChecks": [],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0.5
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    }
  ]
}
