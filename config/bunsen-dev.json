{
  "id": "/bunsen-dev",
  "apps": [
    {
      "id": "/bunsen-dev/provisioner",
      "cmd": "",
      "cpus": 0.1,
      "mem": 100,
      "ports": [
        3001
      ],
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-provisioner",
          "portMappings": [
            {
              "containerPort": 3001,
              "servicePort": 3001,
              "protocol": "tcp"
            }
          ]
        }
      },
      "env": {
        "PROVISIONER_PORT": 3001,
        "PROVISIONER_LIFECYCLE_STRATEGY": "marathon",
        "PROVISIONER_DATABASE_URI": "datomic:mem://provisioner",
        "BAMBOO_URL": "http://172.17.42.1:8000",
        "MARATHON_URL": "http://172.17.42.1:8080",
        "BAMBOO_HOST": "bunsen-dev",
        "SCRATCH_SPACE_ROOT": "/mnt/lustre/bunsen-dev/beaker",
        "COOKIE_SALT": "r8T`628DaW90*?30)3qRx,2f8h?8(wG13:64K3=w00-8W7g962gM268D0lTS(Uq;^v15mY3gCj-u59k994_/@}W<",
        "BAMBOO_PATH": "/provisioner",
        "APP_GROUP": "/bunsen-dev/beaker",
        "APP_DEFAULTS": {
          "container": {
            "type": "DOCKER",
            "docker": {
              "image": "mojotech/bunsen-beaker",
              "network": "BRIDGE",
              "portMappings": [
                {
                  "containerPort": 8801
                }
              ]
            }
          },
          "cpus": 0.1,
          "mem": 100,
          "instances": 1
        },
        "SERVICE_HOST": "bunsen-dev",
        "SERVICE_PATH": "/beaker"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/provisioner/v1/status",
          "gracePeriodSeconds": 60,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 5
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      }
    },
    {
      "id": "/bunsen-dev/marketplace",
      "cmd": "",
      "cpus": 0.1,
      "mem": 100,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-marketplace",
          "portMappings": [
            {
              "containerPort": 8444
            }
          ]
        }
      },
      "env": {
        "BAMBOO_PATH": "/marketplace",
        "BAMBOO_HOST": "bunsen-dev",
        "COOKIE_SALT": "r8T`628DaW90*?30)3qRx,2f8h?8(wG13:64K3=w00-8W7g962gM268D0lTS(Uq;^v15mY3gCj-u59k994_/@}W<",
        "MARKETPLACE_PORT": 8444,
        "ELASTICSEARCH_HOST": "172.17.42.1",
        "ELASTICSEARCH_PORT": 9200,
        "ELASTICSEARCH_USER": "bunsen",
        "ELASTICSEARCH_PASS": "s6nFTwtbZP3wHh"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/marketplace/v1/status",
          "gracePeriodSeconds": 60,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 5
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      }
    },
    {
      "id": "/bunsen-dev/api",
      "cmd": "",
      "cpus": 0.1,
      "mem": 100,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-api",
          "portMappings": [
            {
              "containerPort": 3000,
              "protocol": "tcp"
            }
          ]
        },
        "volumes": [
          {
            "hostPath": "/mnt/lustre/bunsen-dev/repos",
            "containerPath": "/var/app/.repos",
            "mode": "RW"
          },
          {
            "hostPath": "/mnt/lustre/bunsen-dev/scratch",
            "containerPath":"/mnt/lustre/bunsen-dev/scratch",
            "mode":"RW"
          }
        ]
      },
      "env": {
        "NODE_ENV": "development",
        "ALLOW_CROSS_ORIGIN": true,
        "ALLOW_SEED": true,
        "EXTERNAL_DB_HOST": "172.17.42.1",
        "EXTERNAL_DB_USER": "postgres",
        "EXTERNAL_DB_PASS": "",
        "EXTERNAL_DB_NAME": "bunsen_dev",
        "DB_PORT_5432_TCP_ADDR": "172.17.42.1",
        "DB_PORT_5432_TCP_PORT": 5432,
        "HOSTNAME": "bunsen-dev",
        "MANDRILL_PASSWORD": "-QG6MBSWNPR7sPwRali8Jg",
        "MANDRILL_USER": "ops+mandrill@mojotech.com",
        "MAIL_FROM": "ops+bunsen@mojotech.com",
        "ELASTICSEARCH_PORT_9200_TCP_ADDR": "172.17.42.1",
        "ELASTICSEARCH_PORT_9200_TCP_PORT": 9200,
        "ELASTICSEARCH_VERSION": 1.3,
        "SCRATCH_SPACE_ROOT": "/mnt/lustre/bunsen-dev/beaker",
        "SCRATCH_SPACE_PRESENTATION_DIR":"/tmp/bunsen/scratch",
        "QUOTA": 10485760,
        "COOKIE_SALT": "r8T`628DaW90*?30)3qRx,2f8h?8(wG13:64K3=w00-8W7g962gM268D0lTS(Uq;^v15mY3gCj-u59k994_/@}W<",
        "BAMBOO_HOST": "bunsen-dev",
        "BAMBOO_PATH": "/api"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/api/status",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 10
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      },
      "dependencies": [
        "../postgres",
        "../provisioner",
        "../elasticsearch"
      ]
    },
    {
      "id": "/bunsen-dev/web",
      "args":["run"],
      "cpus": 0.1,
      "mem": 100,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-web",
          "portMappings": [
            {
              "containerPort": 8081,
              "hostPort": 0,
              "servicePort": 8081,
              "protocol": "tcp"
            }
          ]
        }
      },
      "env": {
        "WEB_ROOT": "public",
        "BAMBOO_HOST": "bunsen-dev",
        "BAMBOO_ACLS": "!{ path_beg -i /api } !{ path_beg -i /beaker } !{ path_beg -i /events } !{ path_beg -i /marketplace }"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      }
    },
    {
      "id": "/bunsen-dev/riemann",
      "cmd": "",
      "cpus": 0.1,
      "mem": 100,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-riemann",
          "portMappings": [
            {
              "containerPort": 5556,
              "servicePort": 5556
            }
          ]
        }
      },
      "env": {
        "LIBRATO_USER": "chris@mojotech.com",
        "LIBRATO_TOKEN": "f7dbfefb544dbe35dc0812590ff6eaeb0d8eda87c53e707b3d60a68f7f0f451b",
        "BAMBOO_PATH": "/events",
        "BAMBOO_HOST": "bunsen-dev"
      },
      "healthChecks": [
        {
          "protocol": "TCP",
          "path": ".",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0.5
      }
    },
    {
      "id": "/bunsen-dev/datomic",
      "cmd": "",
      "cpus": 1,
      "mem": 1024,
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-datomic",
          "portMappings": [
            {
              "containerPort": 4334,
              "servicePort": 4334
            }
          ]
        }
      },
      "env": {
        "DATOMIC_PROTOCOL": "dev"
      },
      "healthChecks": [
        {
          "protocol": "TCP",
          "path": ".",
          "gracePeriodSeconds": 10,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 3
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0.5
      },
      "uris": [
        "file:///etc/.dockercfg"
      ]
    },
    {
      "id": "/bunsen-dev/user",
      "cmd": "",
      "cpus": 0.1,
      "mem": 100,
      "ports": [
        3004
      ],
      "instances": 1,
      "container": {
        "type": "DOCKER",
        "docker": {
          "network": "BRIDGE",
          "image": "mojotech/bunsen-user",
          "portMappings": [
            {
              "containerPort": 3004,
              "servicePort": 3004,
              "protocol": "tcp"
            }
          ]
        }
      },
      "env": {
        "USER_PORT": 3004,
        "USER_DATABASE_URI": "datomic:mem://user",
        "USER_SEED_FILE": "seed.edn",
        "COOKIE_SALT": "r8T`628DaW90*?30)3qRx,2f8h?8(wG13:64K3=w00-8W7g962gM268D0lTS(Uq;^v15mY3gCj-u59k994_/@}W<",
        "BAMBOO_HOST": "bunsen-dev",
        "BAMBOO_PATH": "/user"
      },
      "healthChecks": [
        {
          "protocol": "HTTP",
          "path": "/user/v1/status",
          "gracePeriodSeconds": 60,
          "intervalSeconds": 10,
          "portIndex": 0,
          "timeoutSeconds": 5,
          "maxConsecutiveFailures": 5
        }
      ],
      "upgradeStrategy": {
        "minimumHealthCapacity": 0
      }
    }
  ]
}
